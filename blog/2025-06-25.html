<!-- このテストだけで、Firestore接続＆addLike定義＆ボタン表示が全部動くか分かる -->
<!DOCTYPE html>
<html>
<head><meta charset="UTF-8"><title>Like Test</title></head>
<body>

<h1>Test Like Button</h1>
<button onclick="addLike()">❤️ Like</button>
<p>Likes: <span id="like-count">...</span></p>

<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCtBvct6BKEazVzERc-FNAY8w3hCO8rNU",
    authDomain: "like-counter-blog.firebaseapp.com",
    projectId: "like-counter-blog",
    storageBucket: "like-counter-blog.appspot.com",
    messagingSenderId: "571743964148",
    appId: "1:571743964148:web:423ef8234b2b89e2841b3",
    measurementId: "G-S14T0V9VC0"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const docRef = db.collection("blogLikes").doc("test-post");

  // 定義はwindowに
  window.addLike = async function () {
    try {
      await docRef.update({ count: firebase.firestore.FieldValue.increment(1) });
      const snap = await docRef.get();
      document.getElementById("like-count").textContent = snap.data().count;
    } catch (e) {
      console.error("Like failed:", e);
      document.getElementById("like-count").textContent = "ERR";
    }
  };

  // 初期表示
  docRef.get().then((snap) => {
    if (snap.exists) {
      document.getElementById("like-count").textContent = snap.data().count;
    } else {
      docRef.set({ count: 0 });
      document.getElementById("like-count").textContent = "0";
    }
  });
</script>

</body>
</html>
